---
import ThemeToggle from "./ThemeToggle.tsx";

interface Props {
  variant?: "space" | "paper";
}

const { variant = "paper" } = Astro.props;
const currentPath = Astro.url.pathname;

const tabs = [
  { label: "About", href: "/" },
  { label: "Articles", href: "/article" },
  { label: "Publications", href: "/publications" },
  { label: "Projects", href: "/projects" },
  { label: "Apps", href: "/apps" },
];

function isActive(href: string): boolean {
  if (href === "/") return currentPath === "/";
  return currentPath.startsWith(href);
}

const isSpace = variant === "space";
---

<nav
  class:list={[
    "sticky top-0 z-50 w-full transition-colors",
    isSpace
      ? "bg-transparent"
      : "bg-paper/90 backdrop-blur-md border-b border-rule",
  ]}
>
  <div class="mx-auto flex max-w-4xl items-center justify-between px-6 py-3">
    <a
      href="/"
      class:list={[
        "space-heading text-sm tracking-wider",
        isSpace ? "text-space-fg" : "text-ink",
      ]}
    >
      Seongland
    </a>

    {/* Desktop tabs */}
    <div class="hidden items-center gap-1 sm:flex">
      {
        tabs.map((tab) => (
          <a
            href={tab.href}
            class:list={[
              "rounded-md px-3 py-1.5 text-xs font-medium tracking-wide transition-colors",
              isActive(tab.href)
                ? isSpace
                  ? "text-space-fg bg-space-fg/15"
                  : "text-ink bg-ink/10"
                : isSpace
                  ? "text-space-fg/60 hover:text-space-fg hover:bg-space-fg/10"
                  : "text-ink-3 hover:text-ink hover:bg-ink/5",
            ]}
          >
            {tab.label}
          </a>
        ))
      }
      <div class="ml-2">
        <ThemeToggle client:load />
      </div>
    </div>

    {/* Mobile */}
    <div class="flex items-center gap-2 sm:hidden">
      <ThemeToggle client:load />
      <button
        id="mobile-menu-btn"
        aria-label="Toggle menu"
        class:list={[
          "flex h-8 w-8 items-center justify-center rounded-md transition-colors",
          isSpace ? "text-space-fg hover:bg-space-fg/10" : "text-ink hover:bg-ink/5",
        ]}
      >
        <svg id="hamburger-icon" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="6" x2="21" y2="6" /><line x1="3" y1="12" x2="21" y2="12" /><line x1="3" y1="18" x2="21" y2="18" />
        </svg>
        <svg id="close-icon" class="hidden h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </button>
    </div>
  </div>

  {/* Mobile menu */}
  <div
    id="mobile-menu"
    class:list={[
      "mobile-menu-panel hidden flex-col gap-0.5 px-6 pb-3 sm:hidden",
    ]}
  >
    {
      tabs.map((tab) => (
        <a
          href={tab.href}
          class:list={[
            "rounded-md px-3 py-2 text-sm font-medium transition-colors",
            isActive(tab.href)
              ? isSpace
                ? "text-space-fg bg-space-fg/10"
                : "text-ink bg-ink/8"
              : isSpace
                ? "text-space-fg/50 hover:text-space-fg"
                : "text-ink-3 hover:text-ink",
          ]}
        >
          {tab.label}
        </a>
      ))
    }
  </div>
</nav>

<script>
  const btn = document.getElementById("mobile-menu-btn");
  const menu = document.getElementById("mobile-menu");
  const hamburgerIcon = document.getElementById("hamburger-icon");
  const closeIcon = document.getElementById("close-icon");

  btn?.addEventListener("click", () => {
    const isOpen = !menu?.classList.contains("hidden");
    if (isOpen) {
      menu?.classList.add("hidden");
      hamburgerIcon?.classList.remove("hidden");
      closeIcon?.classList.add("hidden");
    } else {
      menu?.classList.remove("hidden");
      menu?.classList.add("flex");
      hamburgerIcon?.classList.add("hidden");
      closeIcon?.classList.remove("hidden");
    }
  });

  menu?.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", () => {
      menu?.classList.add("hidden");
      hamburgerIcon?.classList.remove("hidden");
      closeIcon?.classList.add("hidden");
    });
  });
</script>
